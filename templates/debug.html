{% extends "base.html" %}

{% block title %}D√©bogage - ü¶Ñ One Trick Pony DS to Grist{% endblock %}

{% block content %}
<style>
    /* Force l'ordre d'affichage des titres de cartes */
    .fr-card__title {
        order: -1 !important;
        margin-bottom: 1rem !important;
    }
    
    .fr-card__content {
        display: flex !important;
        flex-direction: column !important;
    }
</style>

<!-- En-t√™te de page -->
<div class="fr-mb-4w">
    <h1 class="fr-h1">
        <i class="fas fa-bug fr-mr-2w" style="color: #000091;" aria-hidden="true"></i>
        <span style="color: #000091;">Outils de d√©bogage</span>
    </h1>
    <p class="fr-text--lead">Informations syst√®me et diagnostics</p>
</div>

<!-- Test de connectivit√© -->
<div class="fr-card">
    <div class="fr-card__body">
        <div class="fr-card__content">
            <h2 class="fr-card__title">
                <i class="fas fa-network-wired fr-mr-1w" style="color: #000091;" aria-hidden="true"></i>
                <span style="color: #000091;">Test de connectivit√©</span>
            </h2>
            
            <div class="fr-mt-4w">
                <div class="fr-grid-row fr-grid-row--gutters">
                    <div class="fr-col-12 fr-col-md-6">
                        <h3 class="fr-h6">WebSocket</h3>
                        <div id="websocket_status" class="fr-mb-3w">
                            <div class="fr-alert fr-alert--info">
                                <p>Test de connexion WebSocket...</p>
                            </div>
                        </div>
                        <button class="fr-btn fr-btn--secondary" onclick="testWebSocket()">
                            <i class="fas fa-plug fr-mr-1w" aria-hidden="true"></i>
                            Tester WebSocket
                        </button>
                    </div>
                    
                    <div class="fr-col-12 fr-col-md-6">
                        <h3 class="fr-h6">APIs externes</h3>
                        <button class="fr-btn" onclick="testExternalConnections()">
                            <i class="fas fa-satellite-dish fr-mr-1w" aria-hidden="true"></i>
                            Tester les connexions externes
                        </button>
                        <div id="external_tests_result" class="fr-mt-3w"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Variables d'environnement -->
<div class="fr-card fr-mb-4w">
    <div class="fr-card__body">
        <div class="fr-card__content">
            <h2 class="fr-card__title">
                <i class="fas fa-cogs fr-mr-1w" style="color: #000091;" aria-hidden="true"></i>
                <span style="color: #000091;">Variables d'environnement</span>
            </h2>
            
            <div class="fr-mt-4w">
                <div class="fr-grid-row fr-grid-row--gutters">
                    <!-- Variables de filtrage -->
                    <div class="fr-col-12">
                        <h3 class="fr-h6">Variables de filtrage</h3>
                        <div>
                            <table class="fr-table fr-table--no-caption">
                                <thead>
                                    <tr>
                                        <th scope="col">Variable</th>
                                        <th scope="col">Valeur</th>
                                        <th scope="col">Statut</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for var, value in filter_vars.items() %}
                                    <tr>
                                        <td><code class="fr-text--xs">{{ var }}</code></td>
                                        <td><code class="fr-text--xs">{{ value }}</code></td>
                                        <td>
                                            {% if value == "Non d√©fini" %}
                                            <span class="fr-badge fr-badge--warning fr-badge--sm">
                                                <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                                            </span>
                                            {% else %}
                                            <span class="fr-badge fr-badge--info fr-badge--sm">
                                                <i class="fas fa-info" aria-hidden="true"></i>
                                            </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    let wsTestTimeout
    
    document.addEventListener('DOMContentLoaded', function() {
        // Tester automatiquement WebSocket au chargement
        setTimeout(testWebSocket, 1000)
    })
</script>
{% endblock %}
