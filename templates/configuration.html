{% include 'sync_progression.html' %}

<div class="fr-card fr-card--light-grey fr-mb-4w fr-card--no-border">
    <div class="fr-card__body">
        <div class="fr-card__content">
            <h2 class="fr-card__title">Statut de la configuration</h2>
            <div id="config_check_result" class="fr-mt-2w" style="display: none;">
                <div class="fr-alert fr-alert--info">
                    <p>Vérification de la configuration en cours...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="fr-mb-4w">
    <p>Les champs suivis d’un astérisque (*) sont obligatoires.</p>
</div>

<!-- Configuration Démarches Simplifiées -->
<section class="fr-accordion">
  <h2 class="fr-accordion__title">
    <button type="button" id="accordion-ds" class="fr-accordion__btn" aria-expanded="false" aria-controls="accordion-1">1. API Démarches Simplifiées</button>
  </h2>
  <div id="accordion-1" class="fr-collapse fr-accordion--light-grey fr-px-4w">
    <div class="fr-mt-2w fr-px-2w">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-input-group">
            <label class="fr-label" for="ds_api_token">
              Token API *
              <span class="fr-hint-text">Votre token d'accès personnel à l'API</span>
            </label>
            <input class="fr-input input-config" type="password" id="ds_api_token" name="ds_api_token">
            <div id="ds_token_status" class="fr-mt-1v"></div>
          </div>
        </div>
        <div class="fr-col-12 fr-col-md-6 fr-hidden">
          <div class="fr-input-group">
            <label class="fr-label" for="ds_api_url">
              URL de l'API
              <span class="fr-hint-text">Point d'entrée GraphQL de l'API</span>
            </label>
            <input class="fr-input input-config" type="url" id="ds_api_url" name="ds_api_url" 
              value="https://www.demarches-simplifiees.fr/api/v2/graphql">
          </div>
        </div>
      </div>

      <div class="fr-mt-3w">
        <div class="fr-input-group">
          <label class="fr-label" for="demarche_number">
            Numéro de démarche *
            <span class="fr-hint-text">Identifiant numérique de votre démarche</span>
          </label>
          <input class="fr-input input-config" type="number" id="demarche_number" name="demarche_number" 
            placeholder="Ex: 12345" style="max-width: 200px;">
        </div>
      </div>

      <div class="fr-mt-4w">
        <div id="ds_test_result" class="fr-mt-2w"></div>
      </div>
    </div>
  </div>
</section>

<!-- Configuration Grist -->
<section class="fr-accordion">
  <h2 class="fr-accordion__title">
    <button type="button" id="accordion-grist" class="fr-accordion__btn" aria-expanded="false" aria-controls="accordion-2">2. API Grist</button>
  </h2>
  <div id="accordion-2" class="fr-collapse fr-accordion--light-grey fr-px-4w">
    <div class="fr-mt-4w">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6 fr-hidden">
          <div class="fr-input-group">
            <label class="fr-label" for="grist_base_url">
              URL de base Grist
              <span class="fr-hint-text">URL de votre instance Grist</span>
            </label>
            <input class="fr-input input-config" type="url" id="grist_base_url" name="grist_base_url" 
              value="https://grist.numerique.gouv.fr/api">
          </div>
        </div>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-input-group">
            <label class="fr-label" for="grist_api_key">
              Clé API Grist *
              <span class="fr-hint-text">Clé d'accès à votre document Grist</span>
            </label>
            <input class="fr-input input-config" type="password" id="grist_api_key" name="grist_api_key">
            <div id="grist_key_status" class="fr-mt-1v"></div>
          </div>
        </div>
      </div>

      <div class="fr-mt-3w fr-hidden">
        <div class="fr-grid-row fr-grid-row--gutters">
          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-input-group">
              <label class="fr-label" for="grist_doc_id">
                ID du document Grist
                <span class="fr-hint-text">Identifiant du document de destination</span>
              </label>
              <input class="fr-input input-config" type="text" id="grist_doc_id" name="grist_doc_id">
            </div>
          </div>
          <div class="fr-col-12 fr-col-md-6">
            <div class="fr-input-group">
              <label class="fr-label" for="grist_user_id">
                ID utilisateur Grist
                <span class="fr-hint-text">Identifiant de l'utilisateur (récupéré depuis Grist)</span>
              </label>
              <input class="fr-input input-config" type="text" id="grist_user_id" name="grist_user_id">
            </div>
          </div>
        </div>
      </div>

      <div class="fr-mt-4w">
        <div id="grist_test_result" class="fr-mt-2w"></div>
      </div>
    </div>
  </div>
</section>
